test_name: retrieving contributions

# TODO test public response without API key
# TODO test public vs private projects

stages:
  - name: get a random contribution with all fields
    request:
      url: "{tavern.env_vars.MP_CONTRIBS_API_URL}/contributions/"
      method: GET
      headers:
        accept: application/json
        X-API-KEY: "{tavern.env_vars.MP_API_KEY}"
      params:
        per_page: 1
        _limit: 1
        _fields: _all
    response:
      strict: false
      status_code: 200
      save:
        json:
          contrib: "data[0]"

  - name: retrieve single contribution with default fields
    request:
      url: "{tavern.env_vars.MP_CONTRIBS_API_URL}/contributions/{contrib.id:s}/"
      method: GET
      headers:
        accept: application/json
        X-API-KEY: "{tavern.env_vars.MP_API_KEY}"
    response:
      status_code: 200
      json:
        id: "{contrib.id}"
        project: "{contrib.project}"
        identifier: "{contrib.identifier}"
        formula: "{contrib.formula}"
        is_public: !bool "{contrib.is_public}"
        last_modified: "{contrib.last_modified}"
        needs_build: !bool "{contrib.needs_build}"

  - name: retrieve single contribution with all fields
    request:
      url: "{tavern.env_vars.MP_CONTRIBS_API_URL}/contributions/{contrib.id:s}/"
      params:
        _fields: _all
      method: GET
      headers:
        accept: application/json
        X-API-KEY: "{tavern.env_vars.MP_API_KEY}"
    response:
      status_code: 200
      json: !force_original_structure "{contrib}"
